/*! ultimate-datatable version 3.2.2-SNAPSHOT 2016-09-23 
 Ultimate DataTable is distributed open-source under CeCILL FREE SOFTWARE LICENSE. Check out http://www.cecill.info/ for more information about the contents of this license.
*/
"use strict";angular.module("ultimateDataTableServices",[]).factory("datatable",["$http","$filter","$parse","$window","$q","udtI18n","$timeout",function($http,$filter,$parse,$window,$q,udtI18n,$timeout){var constructor=function(iConfig){var datatable={configDefault:{name:"datatable",extraHeaders:{number:0,list:{},dynamic:!0},columns:[],columnsUrl:void 0,lines:{trClass:void 0},search:{active:!0,mode:"remote",url:void 0},filter:{active:!1,highlight:!1,columnMode:!1,showButton:!1},pagination:{active:!0,mode:"remote",pageNumber:0,numberPageListMax:3,pageList:[],numberRecordsPerPage:10,numberRecordsPerPageList:void 0},order:{active:!0,showButton:!0,mode:"remote",by:void 0,reverse:!1,callback:void 0,columns:{}},add:{active:!1,showButton:!0,init:function(){return{}},after:!0},show:{active:!1,showButton:!0,add:function(line){console.log("show : add function is not defined in the controller !!!")}},hide:{active:!1,showButton:!0,byDefault:void 0,columns:{}},edit:{active:!1,withoutSelect:!1,showButton:!0,showLineButton:!1,columnMode:!1,byDefault:!1,start:!1,all:!1,columns:{},lineMode:void 0},save:{active:!1,withoutEdit:!1,keepEdit:!1,showButton:!0,changeClass:!0,mode:"remote",url:void 0,batch:!1,method:"post",value:void 0,callback:void 0,start:!1,number:0,error:0,newData:[]},remove:{active:!1,withEdit:!1,showButton:!0,mode:"remote",url:void 0,callback:void 0,start:!1,counter:0,number:0,error:0,ids:{errors:[],success:[]}},select:{active:!0,showButton:!0,isSelectAll:!1,callback:void 0},mouseevents:{active:!1,overCallback:void 0,leaveCallback:void 0,clickCallback:void 0},cancel:{active:!0,showButton:!0},exportCSV:{active:!1,showButton:!0,delimiter:";",start:!1},otherButtons:{active:!1,template:void 0},messages:{active:!1,errorClass:"alert alert-danger",successClass:"alert alert-success",errorKey:{save:"datatable.msg.error.save",remove:"datatable.msg.error.remove"},successKey:{save:"datatable.msg.success.save",remove:"datatable.msg.success.remove"},text:void 0,clazz:void 0,messagesService:udtI18n(navigator.languages||navigator.language||navigator.userLanguage),transformKey:function(key,args){return this.messagesService.Messages(key,args)}},group:{active:!1,callback:void 0,by:void 0,showButton:!0,after:!0,showOnlyGroups:!1,start:!1,enableLineSelection:!1,columns:{}},mergeCells:{active:!1,rowspans:void 0},showTotalNumberRecords:!0,spinner:{start:!1},callbackEndDisplayResult:function(){},compact:!0},config:void 0,configMaster:void 0,allResult:void 0,allGroupResult:void 0,displayResult:void 0,totalNumberRecords:0,computeDisplayResultTimeOut:void 0,urlCache:{},lastSearchParams:void 0,inc:0,configColumnDefault:{edit:!1,hide:!0,order:!0,type:"text",choiceInList:!1,extraHeaders:{},convertValue:{active:!1}},messages:udtI18n(navigator.language||navigator.userLanguage),resetErrors:function(index){this.displayResult[index].line.errors={}},addErrorsForKey:function(index,data,key){void 0===this.displayResult[index].line.errors&&(this.displayResult[index].line.errors={}),this.displayResult[index].line.errors[key]="";for(var i=0;i<data[key].length;i++)this.displayResult[index].line.errors[key]+=data[key][i]+" "},addErrors:function(index,data){for(var key in data)this.addErrorsForKey(index,data,key)},search:function(params){this.config.edit=angular.copy(this.configMaster.edit),this.config.remove=angular.copy(this.configMaster.remove),this.config.select=angular.copy(this.configMaster.select),this.config.messages=angular.copy(this.configMaster.messages),this.config.pagination.pageNumber=0,this._search(angular.copy(params))},searchLocal:function(searchTerms){if(this.config.filter.active===!0){this.setSpinner(!0);for(var p in searchTerms)void 0==searchTerms[p]||void 0!==searchTerms[p]&&null!==searchTerms[p]&&""!==searchTerms[p]||(searchTerms[p]=void 0);var _allResult=angular.copy(this.allResult);_allResult=$filter("filter")(this.allResult,searchTerms,!1),this._getAllResult=function(){return _allResult},this.totalNumberRecords=_allResult.length,this.computePaginationList(),this.computeDisplayResult();var that=this;this.computeDisplayResultTimeOut.then(function(){that.setSpinner(!1)})}},_getAllResult:function(){return this.allResult},_search:function(params){if(this.config.search.active&&this.isRemoteMode(this.config.search.mode)){this.lastSearchParams=params;var url=this.getUrlFunction(this.config.search.url);if(!url)throw"no url define for search ! ";this.setSpinner(!0);var that=this;$http.get(url(),{params:this.getParams(params),datatable:this}).success(function(data,status,headers,config){config.datatable._setData(data.data,data.recordsNumber),that.computeDisplayResultTimeOut.then(function(){that.setSpinner(!1)})})}},searchWithLastParams:function(){this._search(this.lastSearchParams)},setData:function(data,recordsNumber){this.config.edit=angular.copy(this.configMaster.edit),this.config.remove=angular.copy(this.configMaster.remove),this.config.select=angular.copy(this.configMaster.select),this.config.messages=angular.copy(this.configMaster.messages),this.config.pagination.pageNumber=0,this._setData(data,recordsNumber)},_setData:function(data,recordsNumber){var configPagination=this.config.pagination;configPagination.active&&!this.isRemoteMode(configPagination.mode)&&(this.config.pagination.pageNumber=0),void 0===recordsNumber&&(recordsNumber=data.length),this.allResult=data,this.totalNumberRecords=recordsNumber,this.loadUrlColumnProperty(),this.computeGroup(),this.sortAllResult(),this.computePaginationList(),this.computeDisplayResult(),this._getAllResult=function(){return this.allResult}},getData:function(){return this.allResult},addData:function(data){if(!angular.isUndefined(data)&&angular.isArray(data)&&data.length>0){var configPagination=this.config.pagination;configPagination.active&&!this.isRemoteMode(configPagination.mode)&&(this.config.pagination.pageNumber=0);for(var i=0;i<data.length;i++)this.allResult.push(data[i]);this.totalNumberRecords=this.allResult.length,this.loadUrlColumnProperty(),this.computeGroup(),this.sortAllResult(),this.computePaginationList(),this.computeDisplayResult(),this._getAllResult=function(){return this.allResult}}},addBlankLine:function(){if(this.config.add.active===!0){var newData=this.config.add.init(this),line={edit:!0,selected:!0,trClass:void 0,group:!1,"new":!0};this.config.add.after?this.displayResult.push({data:newData,line:line}):this.displayResult.unshift({data:newData,line:line}),this.config.edit.all=!0}},computeGroup:function(){if(this.config.group.active&&this.config.group.by){var propertyGroupGetter=this.config.group.by.property,groupGetter=$parse(propertyGroupGetter),groupValues=this.allResult.reduce(function(array,value){var groupValue=groupGetter(value);return array[groupValue]||(array[groupValue]=[]),array[groupValue].push(value),array},{}),groups={};this.allGroupResult=[];for(var key in groupValues){var group={},groupData=groupValues[key];$parse("group."+this.config.group.by.id).assign(group,key);var groupMethodColumns=this.getColumnsConfig().filter(function(column){return void 0!==column.groupMethod&&null!==column.groupMethod&&column.property!=propertyGroupGetter}),that=this;groupMethodColumns.forEach(function(column){var propertyGetter=column.property;propertyGetter+=that.getFilter(column);var columnGetter=$parse(propertyGetter),columnSetter=$parse("group."+column.id);if("sum"===column.groupMethod||"average"===column.groupMethod){var result=groupData.reduce(function(value,element){return value+=columnGetter(element)},0);"average"===column.groupMethod&&(result/=groupData.length),isNaN(result)&&(result="#ERROR");try{columnSetter.assign(group,result)}catch(e){console.log("computeGroup Error : "+e)}}else if("unique"===column.groupMethod){var result=$filter("udtUnique")(groupData,column.property);result=result.length>1?"#MULTI":1===result.length?columnGetter(result[0]):void 0,columnSetter.assign(group,result)}else if("countDistinct"===column.groupMethod){var result=$filter("udtCountdistinct")(groupData,propertyGetter);columnSetter.assign(group,result)}else if("collect"===column.groupMethod){var result=$filter("udtCollect")(groupData,propertyGetter);columnSetter.assign(group,result)}else console.error("groupMethod is not managed "+column.groupMethod)}),groups[key]=group,this.allGroupResult.push(group)}this.config.group.data=groups}else this.config.group.data=void 0,this.allGroupResult=void 0},getGroupColumnValue:function(groupValue,columnProperty){for(var i=0;i<this.config.columns.length;i++)if(this.config.columns[i].property===columnProperty){var column=this.config.columns[i],columnGetter=$parse("group."+column.id);return columnGetter(groupValue)}return void console.log("column not found for property :"+columnProperty)},isGroupActive:function(){return this.config.group.active&&this.config.group.start},setGroupColumn:function(column){if(this.config.group.active){var columnId;if(columnId="all"===column?"all":column.id,void 0===this.config.group.by||this.config.group.by.property!==column.property){this.config.group.start=!0,"all"===columnId?(this.config.group.by=columnId,this.config.group.columns.all=!0):(this.config.group.by=column,this.config.order.groupReverse=!1,this.config.group.columns[columnId]=!0,this.config.group.columns.all&&(this.config.group.columns.all=!1));for(var i=0;i<this.config.columns.length;i++)this.config.columns[i].id===columnId?this.config.group.columns[this.config.columns[i].id]=!0:this.config.group.columns[this.config.columns[i].id]=!1}else this.config.group.columns[columnId]=!this.config.group.columns[columnId],(!this.config.group.columns[columnId]||this.config.group.columns.all)&&(this.config.group.by=void 0,this.config.group.columns.all=!1),this.config.group.start=!1;this.config.edit.active&&this.config.edit.start&&(console.log("edit is active, you lost all modification !!"),this.config.edit=angular.copy(this.configMaster.edit)),this.computeGroup(),this.sortAllResult(),this.computePaginationList(),this.computeDisplayResult();var that=this;this.computeDisplayResultTimeOut.then(function(){angular.isFunction(that.config.group.callback)&&that.config.group.callback(this)})}},updateShowOnlyGroups:function(){this.sortAllResult(),this.computePaginationList(),this.computeDisplayResult()},getGroupColumnClass:function(columnId){return this.config.group.active?this.config.group.columns[columnId]?"fa fa-outdent":"fa fa-bars":void 0},addGroup:function(displayResultTmp){var displayResult=[],groupGetter=$parse(this.config.group.by.property),groupConfig=this.config.group;return displayResultTmp.forEach(function(element,index,array){if(!groupConfig.after&&(0===index||groupGetter(element.data)!==groupGetter(array[index-1].data))){var line={edit:void 0,selected:void 0,trClass:void 0,group:!0,"new":!1};this.push({data:groupConfig.data[groupGetter(element.data)],line:line})}if(this.push(element),groupConfig.after&&(index===array.length-1||groupGetter(element.data)!==groupGetter(array[index+1].data))){var line={edit:void 0,selected:void 0,trClass:void 0,group:!0,"new":!1};this.push({data:groupConfig.data[groupGetter(element.data)],line:line})}},displayResult),displayResult},getColumnValue:function(result,column){var colValue=void 0;if(result.line.group||void 0!==column.url&&null!==column.url){if(result.line.group){var v=$parse("group."+column.id)(result.data);colValue=angular.isDefined(v)&&angular.isString(v)&&"#"===v.charAt(0)?v:angular.isDefined(v)?$parse("group."+column.id+this.getFormatter(column))(result.data):void 0,null===colValue&&(colValue=void 0),void 0!==colValue&&"number"===column.type&&(colValue=colValue.replace(/\u00a0/g,""))}else if(!result.line.group&&void 0!==column.url&&null!==column.url){var url=$parse(column.url)(result.data);colValue=$parse(column.property+this.getFilter(column)+this.getFormatter(column))(this.urlCache[url]),null===colValue&&(colValue=void 0),void 0!==colValue&&"number"===column.type&&(colValue=colValue.replace(/\u00a0/g,""))}}else{var property=column.property,isFunction=!1;angular.isFunction(property)&&(property=property(),isFunction=!0),property+=this.getFilter(column),property+=this.getFormatter(column),colValue=$parse(property)(result.data),null===colValue&&(colValue=void 0),void 0===colValue&&isFunction===!0&&(colValue=property),void 0!==colValue&&null!==colValue&&"number"===column.type&&(colValue=colValue.replace(/\u00a0/g,"")),void 0===colValue&&"boolean"===column.type?colValue=this.messages.Messages("datatable.export.no"):void 0!==colValue&&"boolean"===column.type&&(colValue=colValue?this.messages.Messages("datatable.export.yes"):this.messages.Messages("datatable.export.no"))}return colValue},computeRowSpans:function(){if(this.config.mergeCells.active===!0){this.config.mergeCells.rowspans=void 0;var rowspans=void 0;rowspans=new Array(this.displayResult.length);for(var i=0;i<this.displayResult.length;i++)rowspans[i]=new Array(this.config.columns.length);for(var currentDisplayResult=this.displayResult,currentColumns=this.config.columns,previousResult=void 0,nbRowEquals=new Array(this.config.columns.length),j=0;j<nbRowEquals.length;j++)nbRowEquals[j]=0;currentDisplayResult.forEach(function(result,i){currentColumns.forEach(function(column,j){if(i>0&&column.mergeCells){var currentColValue=this.getColumnValue(result,column),previousColValue=this.getColumnValue(previousResult,column);currentColValue===previousColValue?(rowspans[i][j]=0,nbRowEquals[j]++,i===currentDisplayResult.length-1&&(rowspans[i-nbRowEquals[j]][j]=nbRowEquals[j]+1)):(rowspans[i][j]=1,rowspans[i-(nbRowEquals[j]+1)][j]=nbRowEquals[j]+1,nbRowEquals[j]=0)}else 0===i&&(rowspans[i][j]=1)},this),previousResult=result},this),this.config.mergeCells.rowspans=rowspans}},computeDisplayResult:function(){var time=100;void 0!==this.computeDisplayResultTimeOut?$timeout.cancel(this.computeDisplayResultTimeOut):time=0;var that=this;this.computeDisplayResultTimeOut=$timeout(function(){var configPagination=that.config.pagination,_displayResult=[];if(that.config.group.start&&that.config.group.showOnlyGroups){_displayResult=that.allGroupResult.slice(configPagination.pageNumber*configPagination.numberRecordsPerPage,configPagination.pageNumber*configPagination.numberRecordsPerPage+configPagination.numberRecordsPerPage);var displayResultTmp=[];angular.forEach(_displayResult,function(value,key){var line={edit:that.config.edit.start?!0:void 0,selected:void 0,trClass:void 0,group:!0,"new":!1};this.push({data:value,line:line})},displayResultTmp),that.displayResult=displayResultTmp}else{_displayResult=configPagination.active&&!that.isRemoteMode(configPagination.mode)?$.extend(!0,[],that._getAllResult().slice(configPagination.pageNumber*configPagination.numberRecordsPerPage,configPagination.pageNumber*configPagination.numberRecordsPerPage+configPagination.numberRecordsPerPage)):$.extend(!0,[],that._getAllResult());var displayResultTmp=[];angular.forEach(_displayResult,function(value,key){var line={edit:that.config.edit.start?!0:void 0,selected:void 0,trClass:void 0,group:!1,"new":!1};this.push({data:value,line:line})},displayResultTmp),that.config.mergeCells.rowspans=void 0,that.isGroupActive()?that.displayResult=that.addGroup(displayResultTmp):(that.displayResult=displayResultTmp,that.computeRowSpans()),that.config.edit.byDefault&&that.setEdit(),angular.isFunction(that.config.callbackEndDisplayResult)&&that.config.callbackEndDisplayResult()}},time)},loadUrlColumnProperty:function(){var urlColumns=this.getColumnsConfig().filter(function(column){return void 0!==column.url&&null!==column.url}),displayResult=this.allResult,urlQueries=[],urlCache=this.urlCache={};urlColumns.forEach(function(column){displayResult.forEach(function(value){var url=$parse(column.url)(value);angular.isDefined(urlCache[url])||(urlCache[url]="in waiting data ...",urlQueries.push($http.get(url,{url:url})))})}),$q.all(urlQueries).then(function(results){angular.forEach(results,function(result,key){200!==result.status?console.log("Error for load column property : "+result.config.url):urlCache[result.config.url]=result.data})})},computePaginationList:function(){var configPagination=this.config.pagination;if(configPagination.active){configPagination.pageList=[];var currentPageNumber=configPagination.pageNumber,nbPages=Math.ceil(this.totalNumberRecords/configPagination.numberRecordsPerPage);if(this.config.group.active&&this.config.group.start&&this.config.group.showOnlyGroups&&(nbPages=Math.ceil(this.allGroupResult.length/configPagination.numberRecordsPerPage)),currentPageNumber>nbPages-1&&(configPagination.pageNumber=0,currentPageNumber=0),nbPages>1&&nbPages<=configPagination.numberPageListMax)for(var i=0;nbPages>i;i++)configPagination.pageList.push({number:i,label:i+1,clazz:i!=currentPageNumber?"":"active"});else if(nbPages>configPagination.numberPageListMax){var min=currentPageNumber-(configPagination.numberPageListMax-1)/2,max=currentPageNumber+(configPagination.numberPageListMax-1)/2+1;for(0>min?min=0:min>nbPages-configPagination.numberPageListMax&&(min=nbPages-configPagination.numberPageListMax),max<configPagination.numberPageListMax?max=configPagination.numberPageListMax:max>nbPages&&(max=nbPages),configPagination.pageList.push({number:0,label:"<<",clazz:currentPageNumber!=min?"":"disabled"}),configPagination.pageList.push({number:currentPageNumber-1,label:"<",clazz:currentPageNumber!=min?"":"disabled"});max>min;min++)configPagination.pageList.push({number:min,label:min+1,clazz:min!=currentPageNumber?"":"active"});configPagination.pageList.push({number:currentPageNumber+1,label:">",clazz:currentPageNumber!=max-1?"":"disabled"}),configPagination.pageList.push({number:nbPages-1,label:">>",clazz:currentPageNumber!=max-1?"":"disabled"})}}},setSpinner:function(value){this.config.spinner.start=value},setNumberRecordsPerPage:function(numberRecordsPerPageElement){if(this.config.pagination.active&&angular.isObject(numberRecordsPerPageElement)){this.config.pagination.numberRecordsPerPage=numberRecordsPerPageElement.number,numberRecordsPerPageElement.clazz="active";for(var i=0;i<this.config.pagination.numberRecordsPerPageList.length;i++)this.config.pagination.numberRecordsPerPageList[i].number!=numberRecordsPerPageElement.number&&(this.config.pagination.numberRecordsPerPageList[i].clazz="");this.config.edit.active&&this.config.edit.start&&(console.log("edit is active, you lost all modification !!"),this.config.edit=angular.copy(this.configMaster.edit)),this.config.pagination.pageNumber=0,this.isRemoteMode(this.config.pagination.mode)?this.searchWithLastParams():(this.computePaginationList(),this.computeDisplayResult())}},setPageNumber:function(page){this.config.pagination.active&&angular.isObject(page)&&""===page.clazz&&(this.config.edit.active&&this.config.edit.start&&(console.log("edit is active, you lost all modification !!"),this.config.edit=angular.copy(this.configMaster.edit)),this.config.pagination.pageNumber=page.number,this.isRemoteMode(this.config.pagination.mode)?this.searchWithLastParams():(this.computePaginationList(),this.computeDisplayResult()))},sortAllResult:function(){if(this.config.order.active&&!this.isRemoteMode(this.config.order.mode)){var orderBy=[];if(this.config.group.active&&this.config.group.start&&"all"!==this.config.group.by)if(this.config.group.showOnlyGroups){if(angular.isDefined(this.config.order.by)){var orderProperty="group."+this.config.order.by.id,orderSense=this.config.order.reverse?"-":"+";orderBy.push(orderSense+orderProperty)}this.allGroupResult=$filter("orderBy")(this.allGroupResult,orderBy)}else{var orderGroupSense=this.config.order.groupReverse?"-":"+";if(orderBy.push(orderGroupSense+this.config.group.by.property),angular.isDefined(this.config.order.by)){var orderProperty=this.config.order.by.property;orderProperty+=this.config.order.by.filter?"|"+this.config.order.by.filter:"";var orderSense=this.config.order.reverse?"-":"+";orderBy.push(orderSense+orderProperty)}this.allResult=$filter("orderBy")(this.allResult,orderBy)}else if(angular.isDefined(this.config.order.by)){if(angular.isDefined(this.config.order.by)){var orderProperty=this.config.order.by.property;orderProperty+=this.config.order.by.filter?"|"+this.config.order.by.filter:"";var orderSense=this.config.order.reverse?"-":"+";orderBy.push(orderSense+orderProperty)}this.allResult=$filter("orderBy")(this.allResult,orderBy)}}},setOrderColumn:function(column){if(this.config.order.active){var columnId=column.id;if(angular.isDefined(this.config.group.by)&&this.config.group.by.id===columnId&&!this.config.group.showOnlyGroups)this.config.order.groupReverse=!this.config.order.groupReverse;else{angular.isDefined(this.config.order.by)&&this.config.order.by.id===columnId?this.config.order.reverse=!this.config.order.reverse:(this.config.order.by=column,this.config.order.reverse=!1);for(var i=0;i<this.config.columns.length;i++)this.config.columns[i].id===columnId?this.config.order.columns[this.config.columns[i].id]=!0:this.config.order.columns[this.config.columns[i].id]=!1;this.config.edit.active&&this.config.edit.start&&(console.log("edit is active, you lost all modification !!"),this.config.edit=angular.copy(this.configMaster.edit))}this.isRemoteMode(this.config.order.mode)?this.config.order.active&&this.searchWithLastParams():(this.sortAllResult(),this.computeDisplayResult());var that=this;this.computeDisplayResultTimeOut.then(function(){angular.isFunction(that.config.order.callback)&&that.config.order.callback(this)})}},getOrderColumnClass:function(columnId){if(this.config.order.active){if(angular.isDefined(this.config.group.by)&&this.config.group.by.id===columnId&&!this.config.group.showOnlyGroups)return this.config.order.groupReverse?"fa fa-sort-down":"fa fa-sort-up";if(!this.config.order.columns[columnId])return"fa fa-sort";if(this.config.order.columns[columnId]&&!this.config.order.reverse)return"fa fa-sort-up";if(this.config.order.columns[columnId]&&this.config.order.reverse)return"fa fa-sort-down"}},canOrder:function(){return this.config.edit.active?!this.config.edit.start:this.config.order.active&&!this.isEmpty()},show:function(){this.config.show.active&&angular.isFunction(this.config.show.add)&&angular.forEach(this.displayResult,function(value,key){value.line.selected&&this.config.show.add(value.data)},this)},setHideColumn:function(column){if(this.config.hide.active){var columnId=column.id;this.config.hide.columns[columnId]?this.config.hide.columns[columnId]=!1:this.config.hide.columns[columnId]=!0,this.newExtraHeaderConfig()}},isGroup:function(columnId){return this.config.group.active&&this.config.group.columns[columnId]?this.config.group.columns[columnId]:!1},isHide:function(columnId){return this.config.hide.active&&this.config.hide.columns[columnId]?this.config.hide.columns[columnId]:!1},setEdit:function(column){if(this.config.edit.active){var that=this;this.computeDisplayResultTimeOut.then(function(){that._getAllResult=function(){return that.allResult},that.config.edit.columns={};for(var find=!1,i=0;i<that.displayResult.length;i++)(that.displayResult[i].line.selected||that.config.edit.withoutSelect||that.config.edit.byDefault)&&(angular.isUndefined(that.config.edit.lineMode)||angular.isFunction(that.config.edit.lineMode)&&that.config.edit.lineMode(that.displayResult[i].data))?(that.displayResult[i].line.edit=!0,find=!0):that.displayResult[i].line.edit=!1;if(that.selectAll(!1),find)if(that.config.edit.start=!0,column){that.config.edit.all=!1;var columnId=column.id;angular.isUndefined(that.config.edit.columns[columnId])&&(that.config.edit.columns[columnId]={}),that.config.edit.columns[columnId].edit=!0}else that.config.edit.all=!0})}},isEdit:function(columnId,line){var isEdit=!1;if(this.config.edit.active)if(columnId&&line){angular.isUndefined(this.config.edit.columns[columnId])&&(this.config.edit.columns[columnId]={});var columnEdit=this.config.edit.columns[columnId].edit;isEdit=line.edit&&columnEdit||line.edit&&this.config.edit.all}else if(columnId){angular.isUndefined(this.config.edit.columns[columnId])&&(this.config.edit.columns[columnId]={});var columnEdit=this.config.edit.columns[columnId].edit;isEdit=columnEdit||this.config.edit.all}else isEdit=line?line.edit&&this.config.edit.all:this.config.edit.columnMode&&this.config.edit.start;return isEdit},canEdit:function(){return this.config.edit.withoutSelect?!0:this.isSelect()},updateColumn:function(columnPropertyName,columnId){if(this.config.edit.active)for(var getter=$parse(columnPropertyName),i=0;i<this.displayResult.length;i++)this.displayResult[i].line.edit&&getter.assign(this.displayResult[i].data,this.config.edit.columns[columnId].value)},save:function(){if(this.config.save.active){this.config.save.number=0,this.config.save.error=0,this.config.save.start=!0,this.setSpinner(!0),this.config.messages.text=void 0,this.config.messages.clazz=void 0;for(var data=[],valueFunction=this.getValueFunction(this.config.save.value),i=0;i<this.displayResult.length;i++)(this.displayResult[i].line.edit||this.config.save.withoutEdit)&&(this.config.save.number++,this.displayResult[i].line.trClass=void 0,this.displayResult[i].line.selected=void 0,this.resetErrors(i),this.isRemoteMode(this.config.save.mode)&&!this.config.save.batch?data.push(this.getSaveRemoteRequest(this.displayResult[i].data,i)):this.isRemoteMode(this.config.save.mode)&&this.config.save.batch?data.push({index:i,data:valueFunction(this.displayResult[i].data)}):this.saveLocal(valueFunction(this.displayResult[i].data),i));this.isRemoteMode(this.config.save.mode)&&0!==data.length?this.isRemoteMode(this.config.save.mode)&&!this.config.save.batch?this.saveRemote(data):this.isRemoteMode(this.config.save.mode)&&this.config.save.batch&&this.saveBatchRemote(data):this.saveFinish()}},saveBatchRemote:function(values){for(var nbElementByBatch=Math.ceil(values.length/6),queries=[],i=0;6>i&&values.length>0;i++)queries.push(this.getSaveRemoteRequest(values.splice(0,nbElementByBatch)));$q.all(queries).then(function(results){angular.forEach(results,function(result,key){200!==result.status?console.log("Error for batch save"):angular.forEach(result.data,function(value,key){this.datatable.saveRemoteOneElement(value.status,value.data,value.index)},result.config)})})},saveRemote:function(queries){$q.all(queries).then(function(results){angular.forEach(results,function(value,key){value.config.datatable.saveRemoteOneElement(value.status,value.data,value.config.index)})})},saveRemoteOneElement:function(status,value,index){200!==status?(this.config.save.changeClass&&(this.displayResult[index].line.trClass="danger"),this.displayResult[index].line.edit=!0,this.addErrors(index,value),this.config.save.error++,this.config.save.number--,this.saveFinish()):(this.resetErrors(index),this.saveLocal(value,index),this.saveFinish())},getSaveRemoteRequest:function(value,i){var urlFunction=this.getUrlFunction(this.config.save.url),method=this.config.save.method;angular.isFunction(method)&&(method=method(value));var httpConfig={datatable:this};if(angular.isObject(this.config.save.httpConfig)&&angular.merge(httpConfig,this.config.save.httpConfig),urlFunction){if(this.config.save.batch)return $http[method](urlFunction(value),value,httpConfig);var valueFunction=this.getValueFunction(this.config.save.value);return httpConfig.index=i,$http[method](urlFunction(value),valueFunction(value),httpConfig).success(function(data,status,headers,config){config.datatable.saveRemoteOneElement(status,data,config.index)}).error(function(data,status,headers,config){config.datatable.saveRemoteOneElement(status,data,config.index)})}throw"no url define for save !"},saveLocal:function(data,i){if(this.config.save.active){if(data&&(this.displayResult[i].data=data),this.displayResult[i].line["new"])this.config.save.newData.push(data);else{var j=i;this.config.pagination.active&&!this.isRemoteMode(this.config.pagination.mode)&&(j=i+this.config.pagination.pageNumber*this.config.pagination.numberRecordsPerPage),this.allResult[j]=$.extend(!0,{},this.displayResult[i].data)}this.config.save.keepEdit?this.displayResult[i].line.edit=!0:this.displayResult[i].line.edit=void 0,this.config.save.changeClass&&(this.displayResult[i].line.trClass="success"),this.config.save.number--}},saveFinish:function(){0===this.config.save.number&&(this.config.save.error>0?(this.config.messages.clazz=this.config.messages.errorClass,this.config.messages.text=this.config.messages.transformKey(this.config.messages.errorKey.save,this.config.save.error)):(this.config.messages.clazz=this.config.messages.successClass,this.config.messages.text=this.config.messages.transformKey(this.config.messages.successKey.save)),angular.isFunction(this.config.save.callback)&&this.config.save.callback(this,this.config.save.error),this.config.save.keepEdit||0!==this.config.save.error||(this.config.edit.start=!1),this.config.save.error=0,this.config.save.start=!1,this.config.save.newData.length>0&&this.addData(this.config.save.newData),this.config.save.newData=[],this.setSpinner(!1))},canSave:function(){return!this.config.edit.active||this.config.save.withoutEdit||this.config.save.start?this.config.edit.active&&this.config.save.withoutEdit&&!this.config.save.start?!0:!1:this.config.edit.start},remove:function(){if(this.config.remove.active&&!this.config.remove.start){var r=$window.confirm(this.messages.Messages("datatable.remove.confirm"));if(r){this.setSpinner(!0),this.config.messages.text=void 0,this.config.messages.clazz=void 0,this.config.remove.counter=0,this.config.remove.start=!0,this.config.remove.number=0,this.config.remove.error=0,this.config.remove.ids={errors:[],success:[]};for(var i=0;i<this.displayResult.length;i++)!this.displayResult[i].line.selected||this.displayResult[i].line.edit&&!this.config.remove.withEdit||(this.isRemoteMode(this.config.remove.mode)?(this.config.remove.number++,this.removeRemote(this.displayResult[i].data,i)):this.config.remove.ids.success.push(i));this.isRemoteMode(this.config.remove.mode)||this.removeFinish()}}},removeLocal:function(i){if(this.config.remove.active&&this.config.remove.start){var j;j=this.config.pagination.active&&!this.isRemoteMode(this.config.pagination.mode)?i+this.config.pagination.pageNumber*this.config.pagination.numberRecordsPerPage-this.config.remove.counter:i-this.config.remove.counter,this.allResult.splice(j,1),this.config.remove.counter++,this.totalNumberRecords--}},removeRemote:function(value,i){var url=this.getUrlFunction(this.config.remove.url);if(url)return $http["delete"](url(value),{datatable:this,index:i,value:value}).success(function(data,status,headers,config){config.datatable.config.remove.ids.success.push(config.index),config.datatable.config.remove.number--,config.datatable.removeFinish()}).error(function(data,status,headers,config){config.datatable.config.remove.ids.errors.push(config.value),config.datatable.config.remove.error++,config.datatable.config.remove.number--,config.datatable.removeFinish()});throw"no url define for save !"},removeFinish:function(){if(0===this.config.remove.number){this.config.remove.ids.success.sort(function(a,b){return a-b}).forEach(function(i){this.removeLocal(i)},this),this.config.remove.error>0?(this.config.messages.clazz=this.config.messages.errorClass,this.config.messages.text=this.config.messages.transformKey(this.config.messages.errorKey.remove,this.config.remove.error)):(this.config.messages.clazz=this.config.messages.successClass,this.config.messages.text=this.config.messages.transformKey(this.config.messages.successKey.remove)),angular.isFunction(this.config.remove.callback)&&this.config.remove.callback(this,this.config.remove.error),this.computePaginationList(),this.computeDisplayResult();var that=this;this.computeDisplayResultTimeOut.then(function(){that.config.remove.ids.errors.length>0&&that.displayResult.every(function(value,index){for(var errors=that.config.remove.ids.errors,i=0;i<errors.length;i++)if(angular.equals(value.data,errors[i])){value.line.trClass="danger",errors.splice(i,1);break}return 0===errors.length?!1:!0},that),that.config.select.isSelectAll=!1,that.config.remove.error=0,that.config.remove.start=!1,that.config.remove.counter=0,
that.config.remove.ids={error:[],success:[]},that.setSpinner(!1)})}},canRemove:function(){if(!this.config.remove.active||this.config.remove.start)return!1;for(var i=0;this.displayResult&&i<this.displayResult.length;i++)if(this.displayResult[i].line.selected&&(!this.displayResult[i].line.edit||this.config.remove.withEdit))return!0},selectAll:function(value){if(this.config.select.active){this.config.select.isSelectAll=value;for(var i=0;i<this.displayResult.length;i++)value?this.displayResult[i].line.group?this.displayResult[i].line.group&&this.config.group.enableLineSelection&&(this.displayResult[i].line.groupSelected=!0,this.displayResult[i].line.trClass="info"):(this.displayResult[i].line.selected=!0,this.displayResult[i].line.trClass="info"):this.displayResult[i].line.group?this.displayResult[i].line.group&&this.config.group.enableLineSelection&&(this.displayResult[i].line.groupSelected=!1,this.displayResult[i].line.trClass=void 0):(this.displayResult[i].line.selected=!1,this.displayResult[i].line.trClass=void 0),angular.isFunction(this.config.select.callback)&&this.config.select.callback(this.displayResult[i].line,this.displayResult[i].data)}},getSelection:function(unselect){for(var selection=[],i=0;i<this.displayResult.length;i++)this.displayResult[i].line.selected?(unselect&&(this.displayResult[i].line.selected=!1,this.displayResult[i].line.trClass=void 0),selection.push($.extend(!0,{},this.displayResult[i].data))):this.displayResult[i].line.groupSelected&&(unselect&&(this.displayResult[i].line.groupSelected=!1,this.displayResult[i].line.trClass=void 0),selection.push($.extend(!0,{},this.displayResult[i].data)));return unselect&&(this.config.select.isSelectAll=!1),selection},isSelect:function(){for(var i=0;this.displayResult&&i<this.displayResult.length;i++)if(this.displayResult[i].line.selected)return!0;return!1},isSelectGroup:function(){for(var i=0;this.displayResult&&i<this.displayResult.length;i++)if(this.displayResult[i].line.groupSelected)return!0;return!1},cancel:function(){this.config.cancel.active&&(this.config.edit=angular.copy(this.configMaster.edit),this.config.hide=angular.copy(this.configMaster.hide),this.config.remove=angular.copy(this.configMaster.remove),this.config.select=angular.copy(this.configMaster.select),this.config.messages=angular.copy(this.configMaster.messages),this.totalNumberRecords=this.allResult.length,this.setHideColumnByDefault(),this.newExtraHeaderConfig(),this.computePaginationList(),this.computeDisplayResult())},isShowToolbar:function(){return this.isShowToolbarButtons()||this.isShowToolbarPagination()||this.isShowToolbarResults()},isShowToolbarButtons:function(){return this.isShowCRUDButtons()||this.isShowHideButtons()||this.config.show.active&&this.config.show.showButton||this.isShowExportCSVButton()||this.isShowOtherButtons()},isShowCRUDButtons:function(){return this.config.edit.active&&this.config.edit.showButton||this.config.save.active&&this.config.save.showButton||this.config.remove.active&&this.config.remove.showButton},isShowHideButtons:function(){return this.config.hide.active&&this.config.hide.showButton&&this.getHideColumns().length>0},isShowOtherButtons:function(){return this.config.otherButtons.active&&void 0!==this.config.otherButtons.template},isShowToolbarPagination:function(){return this.config.pagination.active},isShowPagination:function(){return this.config.pagination.active&&this.config.pagination.pageList.length>0},isShowToolbarResults:function(){return this.config.showTotalNumberRecords},isCompactMode:function(){return this.config.compact},isEmpty:function(){return void 0===this.allResult||null===this.allResult||0===this.allResult.length},isShowExportCSVButton:function(){return this.config.exportCSV.active&&this.config.exportCSV.showButton},isShowButton:function(configParam,column){return column?this.config[configParam].active&&(void 0!==this.config[configParam].showButtonColumn&&this.config[configParam].showButtonColumn||this.config[configParam].showButton)&&column[configParam]:this.config[configParam].active&&this.config[configParam].showButton},isShowLineEditButton:function(){return this.config.edit.active&&this.config.edit.showLineButton},setShowButton:function(configParam,value){this.config[configParam].active&&(this.config[configParam].showButton=value)},getParams:function(params){return angular.isUndefined(params)&&(params={}),params.datatable=!0,this.config.pagination.active&&(params.paginationMode=this.config.pagination.mode,this.isRemoteMode(this.config.pagination.mode)&&(params.pageNumber=this.config.pagination.pageNumber,params.numberRecordsPerPage=this.config.pagination.numberRecordsPerPage)),this.config.order.active&&this.isRemoteMode(this.config.order.mode)&&angular.isDefined(this.config.order.by)&&(params.orderBy=this.config.order.by.property,params.orderSense=this.config.order.reverse?"-1":"1"),params},getUrlFunction:function(url){if(angular.isObject(url)){if(angular.isDefined(url.url))return function(value){return url.url}}else{if(angular.isString(url))return function(value){return url};if(angular.isFunction(url))return url}return void 0},getValueFunction:function(valueFunction){return angular.isFunction(valueFunction)?valueFunction:function(value){return value}},isRemoteMode:function(mode){return mode&&"remote"===mode?!0:!1},setHideColumnByDefault:function(){this.config.hide.active&&angular.isDefined(this.config.hide.byDefault)&&(angular.isArray(this.config.hide.byDefault)||(this.config.hide.byDefault=[this.config.hide.byDefault]),angular.forEach(this.config.columns,function(column,key){angular.forEach(this.config.hide.byDefault,function(value,key){value===column.property&&this.setHideColumn(column)},this)},this))},setColumnsConfig:function(columns){if(angular.isDefined(columns)){for(var initPosition=1e6,i=0;i<columns.length;i++){if(columns[i].type&&"string"!==columns[i].type.toLowerCase()?columns[i].type=columns[i].type.toLowerCase():columns[i].type="text",("img"===columns[i].type||"image"===columns[i].type)&&(columns[i].format||console.log("missing format for "+columns[i].property),columns[i].width||(columns[i].width="100%")),columns[i].id=this.generateColumnId(),columns[i].choiceInList&&!angular.isDefined(columns[i].listStyle)&&(columns[i].listStyle="select"),columns[i].choiceInList&&!angular.isDefined(columns[i].possibleValues)&&(columns[i].possibleValues=[]),this.config.group.active&&angular.isDefined(this.config.group.by)&&(columns[i].property===this.config.group.by||columns[i].property===this.config.group.by.property)?(this.config.group.by=columns[i],this.config.group.start=!0,this.config.group.columns[columns[i].id]=!0,columns[i].group=!0):this.config.group.columns[columns[i].id]=!1,this.config.order.active&&angular.isDefined(this.config.order.by)&&(columns[i].property===this.config.order.by||columns[i].property===this.config.order.by.property)?(this.config.order.by=columns[i],this.config.order.columns[columns[i].id]=!0,columns[i].order=!0):this.config.order.columns[columns[i].id]=!1,(null===columns[i].position||void 0===columns[i].position)&&(columns[i].position=initPosition++),void 0!==columns[i].convertValue&&null!==columns[i].convertValue&&columns[i].convertValue.active===!0&&(void 0===columns[i].convertValue.displayMeasureValue||void 0===columns[i].convertValue.saveMeasureValue))throw"Columns config error: "+columns[i].property+" convertValue=active but convertValue.displayMeasureValue or convertValue.saveMeasureValue is missing";(null===columns[i].showFilter||void 0===columns[i].showFilter)&&(columns[i].showFilter=!1)}var settings=$.extend(!0,[],this.configColumnDefault,columns);settings=$filter("orderBy")(settings,"position"),this.config.columns=angular.copy(settings),this.configMaster.columns=angular.copy(settings),this.setHideColumnByDefault(),this.newExtraHeaderConfig(),this.allResult&&(this.computeGroup(),this.sortAllResult(),this.computePaginationList(),this.computeDisplayResult())}},setColumnsConfigWithUrl:function(){$http.get(this.config.columnsUrl,{datatable:this}).success(function(data,status,headers,config){config.datatable.setColumnsConfig(data)})},getColumnsConfig:function(){return this.config.columns},getConfig:function(){return this.config},setConfig:function(config){var settings=$.extend(!0,{},this.configDefault,config);this.config=angular.copy(settings),this.config.pagination.numberRecordsPerPageList||(this.config.pagination.numberRecordsPerPageList=[{number:10,clazz:""},{number:25,clazz:""},{number:50,clazz:""},{number:100,clazz:""}]),this.configMaster=angular.copy(settings),this.config.columnsUrl?this.setColumnsConfigWithUrl():this.setColumnsConfig(this.config.columns),this.displayResult&&this.displayResult.length>0&&(this.computePaginationList(),this.computeDisplayResult())},getHideColumns:function(){for(var c=[],i=0;i<this.config.columns.length;i++)this.config.columns[i].hide&&c.push(this.config.columns[i]);return c},getGroupColumns:function(){for(var c=[],i=0;i<this.config.columns.length;i++)this.config.columns[i].group&&c.push(this.config.columns[i]);return c},getEditColumns:function(){for(var c=[],i=0;i<this.config.columns.length;i++)this.config.columns[i].edit&&c.push(this.config.columns[i]);return c},generateColumnId:function(){return this.inc++,"p"+this.inc},newColumn:function(header,property,edit,hide,order,type,choiceInList,possibleValues,extraHeaders){var column={};return column.id=this.generateColumnId(),column.header=header,column.property=property,column.edit=edit,column.hide=hide,column.order=order,column.type=type,column.choiceInList=choiceInList,void 0!=possibleValues&&(column.possibleValues=possibleValues),void 0!=extraHeaders&&(column.extraHeaders=extraHeaders),column},addColumn:function(position,column){position>=0&&(column.position=position),this.config.columns.push(column),this.setColumnsConfig(this.config.columns),this.newExtraHeaderConfig()},deleteColumn:function(position){this.config.columns.splice(position,1),this.newExtraHeaderConfig()},addToExtraHeaderConfig:function(pos,header){angular.isDefined(this.config.extraHeaders.list[pos])||(this.config.extraHeaders.list[pos]=[]),this.config.extraHeaders.list[pos].push(header)},getExtraHeaderConfig:function(){return this.config.extraHeaders.list},newExtraHeaderConfig:function(){if(this.config.extraHeaders.dynamic===!0){this.config.extraHeaders.list={};for(var lineUsed=!1,count=0,i=0;i<this.config.extraHeaders.number;i++){lineUsed=!1;for(var header=void 0,j=0;j<this.config.columns.length;j++)this.isHide(this.config.columns[j].id)||(void 0!==this.config.columns[j].extraHeaders&&void 0!==this.config.columns[j].extraHeaders[i]?(lineUsed=!0,count>0&&(this.addToExtraHeaderConfig(i,{label:"",colspan:count}),count=0),void 0===header&&(header={label:this.config.columns[j].extraHeaders[i],colspan:0}),this.config.columns[j].extraHeaders[i]===header.label?header.colspan+=1:(this.addToExtraHeaderConfig(i,header),header={label:this.config.columns[j].extraHeaders[i],colspan:1})):void 0!==header?(lineUsed=!0,this.addToExtraHeaderConfig(i,header),count++,header=void 0):count++);count>0&&(lineUsed===!0||void 0!==header)&&(this.addToExtraHeaderConfig(i,{label:"",colspan:count}),count=0),void 0!==header&&this.addToExtraHeaderConfig(i,header)}}},exportCSV:function(exportType){if(this.config.exportCSV.active){this.config.exportCSV.start=!0;var colValue,delimiter=this.config.exportCSV.delimiter,lineValue="",that=this,displayResultTmp=[];if(angular.forEach(this.allResult,function(value,key){var line={edit:void 0,selected:void 0,trClass:void 0,group:!1,"new":!1};this.push({data:value,line:line})},displayResultTmp),this.isGroupActive()&&(displayResultTmp=this.addGroup(displayResultTmp)),displayResultTmp){var columnsToPrint=this.config.columns;columnsToPrint.forEach(function(column){if(!that.config.hide.columns[column.id]){var header=column.header;angular.isFunction(header)&&(header=header()),that.isGroupActive()&&("sum"===column.groupMethod?header+=this.messages.Messages("datatable.export.sum"):"average"===column.groupMethod?header+=this.messages.Messages("datatable.export.average"):"unique"===column.groupMethod?header+=this.messages.Messages("datatable.export.unique"):"countDistinct"===column.groupMethod&&(header+=this.messages.Messages("datatable.export.countDistinct"))),lineValue=lineValue+header+delimiter}},this),lineValue=lineValue.substr(0,lineValue.length-1)+"\n",displayResultTmp.forEach(function(result){columnsToPrint.forEach(function(column){if(!that.config.hide.columns[column.id])if(result.line.group||void 0!==column.url&&null!==column.url||"groupsOnly"===exportType){if(result.line.group){var v=$parse("group."+column.id)(result.data);colValue=angular.isDefined(v)&&angular.isString(v)&&"#"===v.charAt(0)?v:angular.isDefined(v)?$parse("group."+column.id+that.getFormatter(column))(result.data):void 0,null===colValue&&(colValue=void 0),void 0!==colValue&&"number"===column.type&&(colValue=colValue.replace(/\u00a0/g,"")),lineValue=lineValue+(null!==colValue&&colValue?colValue:"")+delimiter}else if(!result.line.group&&void 0!==column.url&&null!==column.url&&"groupsOnly"!==exportType){var url=$parse(column.url)(result.data);colValue=$parse(column.property+that.getFilter(column)+that.getFormatter(column))(that.urlCache[url]),null===colValue&&(colValue=void 0),void 0!==colValue&&"number"===column.type&&(colValue=colValue.replace(/\u00a0/g,"")),lineValue=lineValue+(null!==colValue&&colValue?colValue:"")+delimiter}}else{var property=column.property,isFunction=!1;angular.isFunction(property)&&(property=property(),isFunction=!0),property+=that.getFilter(column),property+=that.getFormatter(column),colValue=$parse(property)(result.data),null===colValue&&(colValue=void 0),void 0===colValue&&isFunction===!0&&(colValue=property),void 0!==colValue&&"number"===column.type&&(colValue=colValue.replace(/\u00a0/g,"")),void 0===colValue&&"boolean"===column.type?colValue=this.messages.Messages("datatable.export.no"):void 0!==colValue&&"boolean"===column.type&&(colValue=colValue?this.messages.Messages("datatable.export.yes"):this.messages.Messages("datatable.export.no")),lineValue=lineValue+(null!==colValue&&colValue?colValue:"")+delimiter}},this),("all"===exportType||"groupsOnly"===exportType&&result.line.group)&&(lineValue=lineValue.substr(0,lineValue.length-1)+"\n")},this),displayResultTmp=void 0;var fixedstring="\ufeff"+lineValue,blob=new Blob([fixedstring],{type:"text/plain;charset=utf-8"}),currdatetime=$filter("date")(new Date,"yyyyMMdd_HHmmss"),text_filename=(this.config.name||this.configDefault.name)+"_"+currdatetime;saveAs(blob,text_filename+".csv")}else alert("No data to print. Select the data you need");this.config.exportCSV.start=!1}},getFormatter:function(col){var format="";return col&&col.type&&("date"===col.type?format+=" | date:'"+(col.format?col.format:this.messages.Messages("date.format"))+"'":"datetime"===col.type?format+=" | date:'"+(col.format?col.format:this.messages.Messages("datetime.format"))+"'":"number"===col.type&&(format+=" | number"+(col.format?":"+col.format:""))),format},getFilter:function(col){var filter="";return void 0!==col.convertValue&&null!==col.convertValue&&col.convertValue.active===!0&&col.convertValue.saveMeasureValue!=col.convertValue.displayMeasureValue&&(filter+="|udtConvert:"+JSON.stringify(col.convertValue)),col.filter?filter+"|"+col.filter:filter},canExportCSV:function(){return!this.config.exportCSV.active||this.config.exportCSV.start||this.isEmpty()?!1:this.config.edit.active&&this.config.edit.start?!1:!0},onDrop:function(e,draggedCol,droppedCol,datatable,alReadyInTheModel){for(var posDrop=droppedCol.position,posDrag=draggedCol.position,i=0;i<datatable.config.columns.length;i++)posDrop>posDrag&&datatable.config.columns[i].position>posDrag&&datatable.config.columns[i].position<posDrop&&datatable.config.columns[i].id!==draggedCol.id&&datatable.config.columns[i].position--,posDrag>posDrop&&datatable.config.columns[i].position>posDrop&&datatable.config.columns[i].position<posDrag&&datatable.config.columns[i].id!==draggedCol.id&&datatable.config.columns[i].position++,datatable.config.columns[i].id===draggedCol.id&&(datatable.config.columns[i].position=posDrop-1);datatable.setColumnsConfig(datatable.config.columns)}};return 2===arguments.length&&(iConfig=arguments[1],console.log("used bad constructor for datatable, only one argument is required the config")),datatable.setConfig(iConfig),datatable};return constructor}]),angular.module("ultimateDataTableServices").directive("udtAutoselect",["$parse",function($parse){var OPTIONS_REGEXP=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w\d]*)|(?:\(\s*([\$\w][\$\w\d]*)\s*,\s*([\$\w][\$\w\d]*)\s*\)))\s+in\s+(.*)$/;return{require:"ngModel",link:function(scope,element,attrs,ngModel){var valOption=void 0;if(attrs.ngOptions?valOption=attrs.ngOptions:attrs.btOptions&&(valOption=attrs.btOptions),void 0!==valOption){var match=valOption.match(OPTIONS_REGEXP),model=$parse(match[7]);scope.$watch(model,function(value){value&&(1!==value.length||void 0!==ngModel.$modelValue&&""!==ngModel.$modelValue||(ngModel.$setViewValue(value[0].code),ngModel.$render()))})}else console.log("ng-options or bt-options required")}}}]),angular.module("ultimateDataTableServices").directive("udtBtselect",["$parse","$document","$window","$filter",function($parse,$document,$window,$filter){var BT_OPTIONS_REGEXP=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*))\s+in\s+([\s\S]+?)$/;return{restrict:"A",replace:!1,scope:!0,template:'<div ng-switch on="isEdit()"><div ng-switch-when="false"><ul class="list-unstyled"><li ng-repeat-start="item in getItems()" ng-if="groupBy(item, $index)" ng-bind="itemGroupByLabel(item)" style="font-weight:bold"></li><li ng-repeat-end  ng-if="item.selected" ng-bind="itemLabel(item)" style="padding-left: 15px;"></li></ul></div><div class="dropdown" ng-switch-when="true"><div class="input-group"><input type="text" style="background:white" ng-class="inputClass" ng-model="selectedLabels" placeholder="{{placeholder}}" title="{{placeholder}}" readonly/><div class="input-group-btn"><button tabindex="-1" data-toggle="dropdown" class="btn btn-default btn-sm dropdown-toggle" type="button" ng-disabled="isDisabled()" ng-click="open()"><span class="caret"></span></button><ul class="dropdown-menu dropdown-menu-right"  role="menu"><li ng-if="filter"><input ng-class="inputClass" type="text" ng-click="inputClick($event)" ng-model="filterValue" ng-change="setFilterValue(filterValue)"/></li><li ng-repeat-start="item in getItems()" ng-if="groupBy(item, $index)" class="divider"></li><li class="dropdown-header" ng-if="groupBy(item, $index)" ng-bind="itemGroupByLabel(item)"></li><li ng-repeat-end ng-click="selectItem(item, $event)"><a href="#"><i class="fa fa-check pull-right" ng-show="item.selected"></i><span class="text" ng-bind="itemLabel(item)" style="margin-right:30px;"></span></a></li></ul></div></div></div></div>',require:["?ngModel"],link:function(scope,element,attr,ctrls){function parseBtsOptions(input){var match=input.match(BT_OPTIONS_REGEXP);if(!match)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+input+"'.");return{itemName:match[4],sourceKey:match[5],source:$parse(match[5]),viewMapper:match[2]||match[1],modelMapper:match[1],groupBy:match[3],groupByGetter:match[3]?$parse(match[3].replace(match[4]+".","")):void 0}}function render(){var selectedLabels=[],modelValues=ngModelCtrl.$modelValue||[];if(angular.isArray(modelValues)||(modelValues=[modelValues]),items.length>0)for(var i=0;i<items.length;i++){var item=items[i];item.selected=!1;for(var j=0;j<modelValues.length;j++){var modelValue=modelValues[j];scope.itemValue(item)===modelValue&&(item.selected=!0,selectedLabels.push(scope.itemLabel(item)))}}scope.selectedLabels=selectedLabels}if(ctrls[0]){scope.inputClass=element.attr("class"),scope.placeholder=attr.placeholder,element.attr("class","");var filterValue,ngModelCtrl=ctrls[0],multiple=attr.multiple||!1,btOptions=attr.btOptions,editMode=attr.ngEdit?$parse(attr.ngEdit):void 0,filter=attr.filter||!1,optionsConfig=parseBtsOptions(btOptions),items=[],groupByLabels={},ngFocus=attr.ngFocus;scope.filter=filter,scope.setFilterValue=function(value){filterValue=value},scope.open=function(){ngFocus&&$parse(ngFocus)(scope)},scope.isDisabled=function(){return attr.ngDisabled?scope.$parent.$eval(attr.ngDisabled):!1},scope.isEdit=function(){return editMode?editMode(scope):!0},scope.getItems=function(){if(scope.isEdit()&&scope.filter){var filter={},getter=$parse(optionsConfig.viewMapper.replace(optionsConfig.itemName+".",""));return getter.assign(filter,filterValue),$filter("limitTo")($filter("filter")(items,filter),20)}return items},scope.groupBy=function(item,index){if(0===index&&(groupByLabels={}),optionsConfig.groupByGetter&&scope.isEdit()){if(0===index||index>0&&optionsConfig.groupByGetter(items[index-1])!==optionsConfig.groupByGetter(item))return!0}else if(optionsConfig.groupByGetter&&!scope.isEdit()&&item.selected&&!groupByLabels[optionsConfig.groupByGetter(item)])return groupByLabels[optionsConfig.groupByGetter(item)]=!0,!0;return!1},scope.itemGroupByLabel=function(item){return optionsConfig.groupByGetter(item)},scope.itemLabel=function(item){return $parse(optionsConfig.viewMapper.replace(optionsConfig.itemName+".",""))(item)},scope.itemValue=function(item){return $parse(optionsConfig.modelMapper.replace(optionsConfig.itemName+".",""))(item)},scope.selectItem=function(item,$event){if(multiple){for(var selectedValues=ngModelCtrl.$viewValue||[],newSelectedValues=[],itemValue=scope.itemValue(item),find=!1,i=0;i<selectedValues.length;i++)selectedValues[i]!==itemValue?newSelectedValues.push(selectedValues[i]):find=!0;find||newSelectedValues.push(itemValue),selectedValues=newSelectedValues,ngModelCtrl.$setViewValue(selectedValues),ngModelCtrl.$render(),$event.preventDefault(),$event.stopPropagation()}else scope.itemValue(item)!==ngModelCtrl.$viewValue?ngModelCtrl.$setViewValue(scope.itemValue(item)):ngModelCtrl.$setViewValue(null),ngModelCtrl.$render()},scope.inputClick=function($event){$event.preventDefault(),$event.stopPropagation()},scope.$watch(optionsConfig.sourceKey,function(newValue,oldValue){newValue&&newValue.length>0&&(items=angular.copy(newValue),render())}),ngModelCtrl.$render=render}}}}]),angular.module("ultimateDataTableServices").directive("udtCell",function(){return{restrict:"A",replace:!0,templateUrl:"udt-cell.html",link:function(scope,element,attr){scope.udtTableFunctions||(scope.udtTableFunctions={}),scope.udtTableFunctions.getEditElement=function(col,header,filter){var editElement="",ngChange='"',defaultValueDirective="";header?ngChange='" udt-change="udtTable.updateColumn(col.property, col.id)"':filter?ngChange='" udt-change="udtTable.searchLocal(udtTable.searchTerms)"':defaultValueDirective='udt-default-value="col"';var userDirectives="";if(void 0!==col.editDirectives&&(userDirectives=col.editDirectives,angular.isFunction(userDirectives)&&(userDirectives=userDirectives())),col.editTemplate)editElement=col.editTemplate.replace("#ng-model",'ng-model="'+this.getEditProperty(col,header,filter)+ngChange);else if("boolean"===col.type)editElement='<input class="form-control"'+defaultValueDirective+'type="checkbox" class="input-small" ng-model="'+this.getEditProperty(col,header,filter)+ngChange+"/>";else if("textarea"===col.type)editElement='<textarea class="form-control"'+defaultValueDirective+userDirectives+'ng-model="'+this.getEditProperty(col,header,filter)+ngChange+"></textarea>";else if("img"===col.type){this.getEditProperty(col,header,filter);editElement='<input ng-if="'+this.getEditProperty(col,header,filter)+' === undefined" type="file" base64-img="'+this.getEditProperty(col,header,filter)+'" /><div  ng-click="setImage('+this.getEditProperty(col,header,filter)+".value,"+this.getEditProperty(col,header,filter)+".fullname,"+this.getEditProperty(col,header,filter)+".width,"+this.getEditProperty(col,header,filter)+'.height)"   class="thumbnail" ng-if="'+this.getEditProperty(col,header,filter)+' !== undefined" >  <div data-target="#modalImage" role="button" data-toggle="modal" >     <a href="#">    <img  ng-src="data:image/{{'+this.getEditProperty(col,header,filter)+".extension}};base64,{{"+this.getEditProperty(col,header,filter)+'.value}}" width="{{'+this.getEditProperty(col,header,filter)+'.width*0.1}}" height="{{'+this.getEditProperty(col,header,filter)+'.height*0.1}}" />     </a> </div> </div> <button  class="btn btn-default btn-xs"  ng-show="'+this.getEditProperty(col,header,filter)+' !== undefined" ng-click="'+this.getEditProperty(col,header,filter)+' = undefined" ><i class="fa fa-trash-o"></i></button> ',header&&(editElement="")}else if("file"===col.type)editElement='<input ng-if="'+this.getEditProperty(col,header,filter)+' === undefined" type="file" base64-file="'+this.getEditProperty(col,header,filter)+'" /><div ng-if="'+this.getEditProperty(col,header,filter)+' !== undefined" ><a target="_blank" ng-href="data:application/{{'+this.getEditProperty(col,header,filter)+".extension}};base64,{{"+this.getEditProperty(col,header,filter)+'.value}}">{{'+this.getEditProperty(col,header,filter)+'.fullname}}</a> </div> <button  class="btn btn-default btn-xs"  ng-show="'+this.getEditProperty(col,header,filter)+' !== undefined" ng-click="'+this.getEditProperty(col,header,filter)+' = undefined" ><i class="fa fa-trash-o"></i></button> ',header&&(editElement="");else if(col.choiceInList)if(col.choiceInList)switch(col.listStyle){case"radio":editElement='<label class="radio-inline" ng-repeat="opt in '+this.getOptions(col)+' track by $index" '+userDirectives+'><input udt-html-filter="{{col.type}}" type="radio" ng-model="'+this.getEditProperty(col,header,filter)+ngChange+' ng-value="{{opt.code}}"> {{opt.name}}</label>';break;case"multiselect":editElement='<select class="form-control" multiple="true" '+defaultValueDirective+' ng-options="opt.code '+this.getFormatter(col)+" as opt.name "+this.getGroupBy(col)+" for opt in "+this.getOptions(col)+'" '+userDirectives+' ng-model="'+this.getEditProperty(col,header,filter)+ngChange+"></select>";break;case"bt-select":editElement='<div udt-html-filter="{{col.type}}" class="form-control" udt-btselect '+defaultValueDirective+' placeholder="" bt-dropdown-class="dropdown-menu-right" bt-options="opt.code as opt.name  '+this.getGroupBy(col)+" for opt in "+this.getOptions(col)+'" '+userDirectives+' ng-model="'+this.getEditProperty(col,header,filter)+ngChange+"></div>";break;case"bt-select-filter":editElement='<div udt-html-filter="{{col.type}}" class="form-control" filter="true" udt-btselect '+defaultValueDirective+' placeholder="" bt-dropdown-class="dropdown-menu-right" bt-options="opt.code as opt.name  '+this.getGroupBy(col)+" for opt in "+this.getOptions(col)+'" '+userDirectives+' ng-model="'+this.getEditProperty(col,header,filter)+ngChange+"></div>";break;case"bt-select-multiple":editElement='<div class="form-control" '+defaultValueDirective+' udt-btselect multiple="true" bt-dropdown-class="dropdown-menu-right" placeholder="" bt-options="opt.code as opt.name  '+this.getGroupBy(col)+" for opt in "+this.getOptions(col)+'" '+userDirectives+' ng-model="'+this.getEditProperty(col,header,filter)+ngChange+"></div>";break;default:editElement='<select udt-html-filter="{{col.type}}" class="form-control" '+defaultValueDirective+' ng-options="opt.code '+this.getFormatter(col)+" as opt.name "+this.getGroupBy(col)+" for opt in "+this.getOptions(col)+'" '+userDirectives+' ng-model="'+this.getEditProperty(col,header,filter)+ngChange+"><option></option></select>"}else editElement="Edit Not Defined for col.type !";else editElement='<input class="form-control" '+defaultValueDirective+" "+this.getConvertDirective(col,header)+' udt-html-filter="{{col.type}}" type="text" class="input-small" ng-model="'+this.getEditProperty(col,header,filter)+ngChange+userDirectives+this.getDateTimestamp(col.type)+"/>";return"<div class=\"form-group\"  ng-class=\"{'has-error': value.line.errors['"+col.property+"'] !== undefined}\">"+editElement+'<span class="help-block" ng-if="value.line.errors[\''+col.property+'\'] !== undefined">{{value.line.errors["'+col.property+'"]}}<br></span></div>'},scope.udtTableFunctions.getEditProperty=function(col,header,filter){if(header)return"udtTable.config.edit.columns."+col.id+".value";if(filter)return"udtTable.searchTerms."+col.property;if(angular.isString(col.property))return"value.data."+col.property;throw"Error property is not editable !"},scope.udtTableFunctions.getConvertDirective=function(col,header){return void 0!==col.convertValue&&null!==col.convertValue&&col.convertValue.active===!0&&col.convertValue.saveMeasureValue!==col.convertValue.displayMeasureValue?'udt-convertvalue="col.convertValue"':""},scope.udtTableFunctions.getInputType=function(col){return"date"===col.type||"datetime"===col.type||"datetime-local"===col.type?"text":col.type},scope.udtTableFunctions.getFormatter=scope.udtTable.getFormatter,scope.udtTableFunctions.getFilter=scope.udtTable.getFilter,scope.udtTableFunctions.getOptions=function(col){return angular.isString(col.possibleValues)?col.possibleValues:"col.possibleValues"},scope.udtTableFunctions.getGroupBy=function(col){return angular.isString(col.groupBy)?"group by opt."+col.groupBy:""},scope.udtTableFunctions.getDateTimestamp=function(colType){return"date"===colType?"udt-date-timestamp":""}}}}).directive("udtEditableCell",function(){return{restrict:"A",replace:!0,templateUrl:"udt-editableCell.html",link:function(scope,element,attr){}}}).directive("udtCellHeader",function(){return{restrict:"A",replace:!0,templateUrl:"udt-cellHeader.html",link:function(scope,element,attr){}}}).directive("udtCellFilter",function(){return{restrict:"A",replace:!0,templateUrl:"udt-cellFilter.html",link:function(scope,element,attr){}}}).directive("udtCellEdit",function(){return{restrict:"A",replace:!0,templateUrl:"udt-cellEdit.html",link:function(scope,element,attr){}}}).directive("udtCellRead",function(){return{restrict:"A",replace:!0,templateUrl:"udt-cellRead.html",link:function(scope,element,attr){scope.udtTableFunctions||(scope.udtTableFunctions={}),scope.udtTableFunctions.getDisplayElement=function(col){return angular.isDefined(col.render)&&null!==col.render?angular.isFunction(col.render)?'<span udt-compile="udtTable.config.columns[$index].render(value.data, value.line)"></span>':angular.isString(col.render)?'<span udt-compile="udtTable.config.columns[$index].render"></span>':void 0:"boolean"===col.type?'<div ng-switch on="cellValue"><i ng-switch-when="true" class="fa fa-check-square-o"></i><i ng-switch-default class="fa fa-square-o"></i></div>':"img"===col.type?'<div  ng-click="setImage(cellValue.value,cellValue.fullname,cellValue.width,cellValue.height)"  class="thumbnail" ng-if="cellValue !== undefined" > <div data-target="#modalImage" role="button" data-toggle="modal" ><a href="#"><img ng-src="data:image/{{cellValue.extension}};base64,{{cellValue.value}}" width="{{cellValue.width*0.1}}" height="{{cellValue.height*0.1}}"/></a></div></div>':"file"===col.type?'<a target="_blank" ng-href="data:application/{{cellValue.extension}};base64,{{cellValue.value}}">{{cellValue.fullname}}</a>':'<span ng-bind="cellValue"></span>'};var getDisplayFunction=function(col,onlyProperty){return angular.isFunction(col.property)?col.property(scope.value.data):getDisplayValue(col,scope.value,onlyProperty,scope)},getDisplayValue=function(column,value,onlyProperty,currentScope){if(onlyProperty)return column.watch===!0&&scope.$watch("value.data."+column.property,function(newValue,oldValue){newValue!==oldValue&&(scope.cellValue=getDisplayFunction(column,!1))}),currentScope.$eval(column.property,value.data);if(!(value.line.group||void 0!==column.url&&null!==column.url))return column.watch===!0&&scope.$watch("value.data."+column.property,function(newValue,oldValue){newValue!==oldValue&&(scope.cellValue=getDisplayFunction(column,!1));
}),currentScope.$eval(column.property+currentScope.udtTableFunctions.getFilter(column)+currentScope.udtTableFunctions.getFormatter(column),value.data);if(value.line.group){var v=currentScope.$eval("group."+column.id,value.data);return angular.isDefined(v)&&angular.isString(v)&&"#"===v.charAt(0)?v:angular.isDefined(v)?currentScope.$eval("group."+column.id+currentScope.udtTableFunctions.getFormatter(column),value.data):void 0}if(!value.line.group&&void 0!==column.url&&null!==column.url){var url=currentScope.$eval(column.url,value.data);return currentScope.$eval(column.property+currentScope.udtTableFunctions.getFilter(column)+currentScope.udtTableFunctions.getFormatter(column),scope.udtTable.urlCache[url])}};"img"===scope.col.type||"image"===scope.col.type?scope.cellValue=getDisplayFunction(scope.col,!0):scope.cellValue=getDisplayFunction(scope.col,!1)}}}),angular.module("ultimateDataTableServices").directive("udtChange",["$interval",function($interval){return{require:"ngModel",link:function(scope,element,attrs,ngModel){scope.$watch(attr.ngModel,function(newValue,oldValue){newValue!==oldValue&&scope.$eval(attr.udtChange)})}}}]),angular.module("ultimateDataTableServices").directive("udtCompile",["$compile",function($compile){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.udtCompile)},function(value){element.html(value),$compile(element.contents())(scope)})}}}]),angular.module("ultimateDataTableServices").directive("udtConvertvalue",["udtConvertValueServices","$filter",function(udtConvertValueServices,$filter){return{require:"ngModel",link:function(scope,element,attr,ngModel){var convertValues=udtConvertValueServices(),property=void 0,watchModelValue=function(){return scope.$watch(function(){return ngModel.$modelValue},function(newValue,oldValue){if(void 0!=property){var convertedValue=convertValues.convertValue(newValue,property.saveMeasureValue,property.displayMeasureValue);ngModel.$setViewValue($filter("number")(convertedValue)),ngModel.$render()}})};scope.$watch(attr.udtConvertvalue,function(value){void 0!=value.saveMeasureValue&&void 0!=value.displayMeasureValue&&(property=value)}),element.bind("blur",function(){var convertedValue=convertValues.convertValue(ngModel.$modelValue,property.saveMeasureValue,property.displayMeasureValue);ngModel.$setViewValue($filter("number")(convertedValue)),ngModel.$render(),scope.currentWatcher=watchModelValue()}),element.bind("focus",function(){scope.currentWatcher()}),scope.currentWatcher=watchModelValue(),ngModel.$parsers.push(function(value){return value=convertValues.parse(value),void 0!=property&&(value=convertValues.convertValue(value,property.displayMeasureValue,property.saveMeasureValue)),value})}}}]),angular.module("ultimateDataTableServices").directive("udtDateTimestamp",function(){return{require:"ngModel",link:function(scope,ele,attr,ngModel){var typedDate="01/01/1970",convertToDate=function(date){if(null!==date&&void 0!==date&&""!==date){var format=scope.udtTableFunctions.messages.Messages("date.format").toUpperCase();return date=moment(date).format(format)}return""},convertToTimestamp=function(date){if(null!==date&&void 0!==date&&""!==date){var format=scope.udtTableFunctions.messages.Messages("date.format").toUpperCase();return moment(date,format).valueOf()}return""};scope.$watch(function(){return ngModel.$modelValue},function(newValue,oldValue){if(null!==newValue&&void 0!==newValue&&""!==newValue&&10===typedDate.length){var date=convertToDate(newValue);ngModel.$setViewValue(date),ngModel.$render()}}),ngModel.$parsers.push(function(value){var date=value;return typedDate=date,10===value.length&&(date=convertToTimestamp(value)),date})}}}),angular.module("ultimateDataTableServices").directive("udtDefaultValue",["$parse",function($parse){return{require:"ngModel",link:function(scope,element,attrs,ngModel){var _col=null;scope.$watch(attrs.udtDefaultValue,function(col){null!==col&&void 0!==col&&void 0!==col.defaultValues&&null!==col.defaultValues&&(_col=col)}),scope.$watch(ngModel,function(value){null==_col||void 0!==ngModel.$modelValue&&""!==ngModel.$modelValue||("boolean"===_col.type?"true"===_col.defaultValues||_col.defaultValues===!0?(ngModel.$setViewValue(!0),ngModel.$render()):("false"===_col.defaultValues||_col.defaultValues===!1)&&(ngModel.$setViewValue(!1),ngModel.$render()):(ngModel.$setViewValue(_col.defaultValues),ngModel.$render()))})}}}]),angular.module("ultimateDataTableServices").directive("udtForm",function(){return{restrict:"A",replace:!0,transclude:!0,templateUrl:"udt-form.html",link:function(scope,element,attr){}}}),angular.module("ultimateDataTableServices").directive("udtHighlight",function(){var component=function(scope,element,attrs){attrs.highlightClass||(attrs.highlightClass="udt-highlight"),attrs.active||(scope.active=!0);var replacer=function(match,item){return'<span class="'+attrs.highlightClass+'">'+match+"</span>"},tokenize=function(keywords){keywords=keywords.replace(new RegExp(",$","g"),"").split(",");var i,l=keywords.length;for(i=0;l>i;i++)keywords[i]=keywords[i].replace(new RegExp("^ | $","g"),"");return keywords};scope.$watch("keywords",function(newValue,oldValue){if(!newValue||""===newValue||!scope.active)return void 0!==scope.udtHighlight&&null!==scope.udtHighlight&&element.html(scope.udtHighlight.replace(/\n/g,"<br />").toString()),!1;var tokenized=tokenize(newValue),regex=new RegExp(tokenized.join("|"),"gmi"),html=scope.udtHighlight.replace(/\n/g,"<br />").toString().replace(regex,replacer);element.html(html)},!0)};return{link:component,replace:!1,scope:{active:"=",udtHighlight:"=",keywords:"="}}}),angular.module("ultimateDataTableServices").directive("udtHtmlFilter",function($filter){return{require:"ngModel",link:function(scope,element,attrs,ngModelController){ngModelController.$formatters.push(function(data){var convertedData=data;return"datetime"===attrs.udtHtmlFilter?convertedData=$filter("date")(convertedData,scope.udtTableFunctions.messages.Messages("datetime.format")):"date"===attrs.udtHtmlFilter?convertedData=$filter("date")(convertedData,scope.udtTableFunctions.messages.Messages("date.format")):"number"===attrs.udtHtmlFilter&&(convertedData=$filter("number")(convertedData)),convertedData}),ngModelController.$parsers.push(function(data){var convertedData=data;return"number"===attrs.udtHtmlFilter&&null!==convertedData&&void 0!==convertedData&&angular.isString(convertedData)&&(convertedData=convertedData.replace(",","."),isNaN(convertedData)||""===convertedData?(isNaN(convertedData)||""===convertedData)&&(convertedData=void 0):convertedData=1*convertedData),convertedData})}}}),angular.module("ultimateDataTableServices").directive("udtMessages",function(){return{restrict:"A",replace:!0,templateUrl:"udt-messages.html",link:function(scope,element,attr){}}}),angular.module("ultimateDataTableServices").directive("udtTable",function(){return{restrict:"A",replace:!0,templateUrl:"udt-table.html",link:function(scope,element,attr){scope.udtTableFunctions||(scope.udtTableFunctions={}),scope.udtTableFunctions.getTrClass=function(data,line,currentScope){var udtTable=scope.udtTable;return line.trClass?line.trClass:angular.isFunction(udtTable.config.lines.trClass)?udtTable.config.lines.trClass(data,line):angular.isString(udtTable.config.lines.trClass)?currentScope.$eval(udtTable.config.lines.trClass)||udtTable.config.lines.trClass:line.group&&!udtTable.config.group.showOnlyGroups?"active":""},scope.udtTableFunctions.getTdClass=function(data,col,currentScope){return angular.isFunction(col.tdClass)?col.tdClass(data):angular.isString(col.tdClass)?currentScope.$eval(col.tdClass)||col.tdClass:""},scope.udtTableFunctions.getThClass=function(col,currentScope){return angular.isFunction(col.thClass)?col.thClass(col):angular.isString(col.thClass)?currentScope.$eval(col.thClass)||col.thClass:""},scope.udtTableFunctions.select=function(data,line){var udtTable=scope.udtTable;line&&(udtTable.config.select.active&&(line.group?line.group&&udtTable.config.group.enableLineSelection&&(line.groupSelected?(line.groupSelected=!1,line.trClass=void 0):(line.groupSelected=!0,line.trClass="info")):line.selected?(line.selected=!1,line.trClass=void 0):(line.selected=!0,line.trClass="info")),udtTable.config.select.active&&angular.isFunction(udtTable.config.select.callback)?(console.warning("select.callback is deprecated. Use mouseevents.clickCallback instead."),udtTable.config.select.callback(line,data)):udtTable.config.mouseevents.active&&angular.isFunction(udtTable.config.mouseevents.clickCallback)&&udtTable.config.mouseevents.clickCallback(line,data))},scope.udtTableFunctions.mouseover=function(data,line){var udtTable=scope.udtTable;if(udtTable.config.mouseevents.active){var cb=udtTable.config.mouseevents.overCallback;angular.isFunction(cb)&&cb(line,data)}},scope.udtTableFunctions.mouseleave=function(data,line){var udtTable=scope.udtTable;if(udtTable.config.mouseevents.active){var cb=udtTable.config.mouseevents.leaveCallback;angular.isFunction(cb)&&cb(line,data)}},scope.udtTableFunctions.getRowSpanValue=function(i,j){var udtTable=scope.udtTable;return udtTable.config.mergeCells.active&&void 0!==udtTable.config.mergeCells.rowspans?udtTable.config.mergeCells.rowspans[i][j]:1},scope.udtTableFunctions.isShowCell=function(col,i,j){var udtTable=scope.udtTable,value=!udtTable.isHide(col.id);return udtTable.config.mergeCells.active&&value&&void 0!==udtTable.config.mergeCells.rowspans&&(value=0!==udtTable.config.mergeCells.rowspans[i][j]),value}}}}),angular.module("ultimateDataTableServices").directive("udtTextareaResize",function(){return{restrict:"A",require:"ngModel",replace:!1,template:"",link:function(scope,element,attr,ngModel){var rows=3,cols=35;scope.$watch(ngModel.$modelValue,function(){var value=ngModel.$modelValue;if(value){var lines=value.split("\n");rows=Math.max(lines.length,rows),lines.forEach(function(line){cols=Math.max(cols,line.length)}),attr.$set("cols",cols),attr.$set("rows",rows)}})}}}),angular.module("ultimateDataTableServices").directive("udtToolbar",function(){return{restrict:"A",replace:!0,templateUrl:"udt-toolbar.html",link:function(scope,element,attr){}}}),angular.module("ultimateDataTableServices").directive("ultimateDatatable",["$parse","$q","$timeout","$templateCache",function($parse,$q,$timeout,$templateCache){return{restrict:"A",replace:!0,scope:!0,transclude:!0,templateUrl:"ultimate-datatable.html",link:function(scope,element,attr){attr.ultimateDatatable&&(scope.$watch(attr.ultimateDatatable,function(newValue,oldValue){!newValue||newValue===oldValue&&scope.udtTable||(scope.udtTable=$parse(attr.ultimateDatatable)(scope))}),scope.udtTable=$parse(attr.ultimateDatatable)(scope),scope.udtTableFunctions||(scope.udtTableFunctions={}),scope.udtTableFunctions.messages={},scope.udtTableFunctions.messages.Messages=function(message,arg){return angular.isFunction(message)&&(message=message()),null==arg||void 0==arg?scope.udtTable.config.messages.transformKey(message):scope.udtTable.config.messages.transformKey(message,arg)},scope.udtTableFunctions.cancel=function(){scope.udtTable.setSpinner(!0),$timeout(function(){scope.udtTable.cancel()}).then(function(){scope.udtTable.computeDisplayResultTimeOut.then(function(){scope.udtTable.setSpinner(!1)})})},scope.udtTableFunctions.setNumberRecordsPerPage=function(elt){scope.udtTable.setSpinner(!0),$timeout(function(){scope.udtTable.setNumberRecordsPerPage(elt)}).then(function(){scope.udtTable.isRemoteMode(scope.udtTable.config.pagination.mode)||scope.udtTable.computeDisplayResultTimeOut.then(function(){scope.udtTable.setSpinner(!1)})})},scope.udtTableFunctions.setPageNumber=function(page){scope.udtTable.setSpinner(!0),$timeout(function(){scope.udtTable.setPageNumber(page)}).then(function(){scope.udtTable.isRemoteMode(scope.udtTable.config.pagination.mode)||scope.udtTable.computeDisplayResultTimeOut.then(function(){scope.udtTable.setSpinner(!1)})})},scope.udtTableFunctions.setEdit=function(column){scope.udtTable.setSpinner(!0),$timeout(function(){scope.udtTable.setEdit(column)}).then(function(){scope.udtTable.setSpinner(!1)})},scope.udtTableFunctions.setOrderColumn=function(column){scope.udtTable.setSpinner(!0),$timeout(function(){scope.udtTable.setOrderColumn(column)}).then(function(){scope.udtTable.isRemoteMode(scope.udtTable.config.order.mode)||scope.udtTable.computeDisplayResultTimeOut.then(function(){scope.udtTable.setSpinner(!1)})})},scope.udtTableFunctions.setHideColumn=function(column){scope.udtTable.setSpinner(!0),$timeout(function(){scope.udtTable.setHideColumn(column)}).then(function(){scope.udtTable.setSpinner(!1)})},scope.udtTableFunctions.setGroupColumn=function(column){scope.udtTable.setSpinner(!0),$timeout(function(){scope.udtTable.setGroupColumn(column)}).then(function(){scope.udtTable.computeDisplayResultTimeOut.then(function(){scope.udtTable.setSpinner(!1)})})},scope.udtTableFunctions.exportCSV=function(exportType){scope.udtTable.setSpinner(!0),$timeout(function(){scope.udtTable.exportCSV(exportType)}).then(function(){scope.udtTable.setSpinner(!1)})},scope.udtTableFunctions.updateShowOnlyGroups=function(){scope.udtTable.setSpinner(!0),$timeout(function(){scope.udtTable.updateShowOnlyGroups()}).then(function(){scope.udtTable.computeDisplayResultTimeOut.then(function(){scope.udtTable.setSpinner(!1)})})},scope.udtTableFunctions.getTotalNumberRecords=function(){return scope.udtTable.config.group.active&&scope.udtTable.config.group.start&&!scope.udtTable.config.group.showOnlyGroups?scope.udtTable.totalNumberRecords+" - "+scope.udtTable.allGroupResult.length:scope.udtTable.config.group.active&&scope.udtTable.config.group.start&&scope.udtTable.config.group.showOnlyGroups?scope.udtTable.allGroupResult?scope.udtTable.allGroupResult.length:0:scope.udtTable.totalNumberRecords})}}}]),angular.module("ultimateDataTableServices").filter("udtCollect",["$parse",function($parse){return function(array,key){if(!array||0===array.length)return void 0;if(!angular.isArray(array)&&(angular.isObject(array)||angular.isNumber(array)||angular.isString(array)||angular.isDate(array)))array=[array];else if(!angular.isArray(array))throw"input is not an array, object, number or string !";if(key&&!angular.isString(key))throw"key is not valid, only string is authorized";var possibleValues=[];return angular.forEach(array,function(element){if(angular.isObject(element)){var currentValue=$parse(key)(element);void 0!==currentValue&&null!==currentValue&&(angular.isArray(currentValue)?Array.prototype.push.apply(possibleValues,currentValue):possibleValues.push(currentValue))}else if(!params.key&&angular.isObject(value))throw"missing key !"}),possibleValues}}]),angular.module("ultimateDataTableServices").filter("udtConvert",["udtConvertValueServices",function(udtConvertValueServices){return function(input,property){var convertValues=udtConvertValueServices();return void 0!=property&&(input=convertValues.convertValue(input,property.saveMeasureValue,property.displayMeasureValue)),input}}]),angular.module("ultimateDataTableServices").filter("udtCountdistinct",["$parse",function($parse){return function(array,key){if(!array||0===array.length)return void 0;if(!angular.isArray(array)&&(angular.isObject(array)||angular.isNumber(array)||angular.isString(array)||angular.isDate(array)))array=[array];else if(!angular.isArray(array))throw"input is not an array, object, number or string !";if(key&&!angular.isString(key))throw"key is not valid, only string is authorized";var possibleValues=[];return angular.forEach(array,function(element){if(angular.isObject(element)){var currentValue=$parse(key)(element);void 0!==currentValue&&null!==currentValue&&-1===possibleValues.indexOf(currentValue)&&possibleValues.push(currentValue)}else if(!params.key&&angular.isObject(value))throw"missing key !"}),possibleValues.length}}]),angular.module("ultimateDataTableServices").filter("udtUnique",["$parse",function($parse){return function(collection,property){function toArray(object){for(var i=-1,props=Object.keys(object),result=new Array(props.length);++i<props.length;)result[i]=object[props[i]];return result}function some(array,member){return array.some(function(el){return equals(el,member)})}var isUndefined=(angular.isDefined,angular.isUndefined),isObject=(angular.isFunction,angular.isString,angular.isNumber,angular.isObject),isArray=angular.isArray,equals=(angular.forEach,angular.extend,angular.copy,angular.equals);if(!isArray(collection)&&!isObject(collection))return collection;if(collection=angular.isObject(collection)?toArray(collection):collection,isUndefined(property))return collection.filter(function(elm,pos,self){return self.indexOf(elm)===pos});var uniqueItems=[],get=$parse(property);return collection.filter(function(elm){var prop=get(elm);return some(uniqueItems,prop)?!1:(uniqueItems.push(prop),!0)})}}]),angular.module("ultimateDataTableServices").factory("udtConvertValueServices",[function(){var constructor=function($scope){var udtConvertValueServices={convertValue:function(value,inputUnit,outputUnit,precision){if(inputUnit!==outputUnit&&!isNaN(value)&&null!==value){var convert=this.getConversion(inputUnit,outputUnit);if(void 0==convert||angular.isFunction(convert)){if(void 0===convert||null===convert)throw"Error: Unknown Conversion "+inputUnit+" to "+outputUnit}else value*=convert,void 0!==precision&&(value=value.toPrecision(precision))}return value},getConversion:function(inputUnit,outputUnit){return"g"===inputUnit&&"ng"===outputUnit||"ml"===inputUnit&&"l"===outputUnit||"pM"===inputUnit&&"nM"===outputUnit?.001:"ng"===inputUnit&&"g"===outputUnit||"l"===inputUnit&&"ml"===outputUnit||"nM"===inputUnit&&"pM"===outputUnit?1e3:"mM"===inputUnit&&"nM"===outputUnit?1e6:"nM"===inputUnit&&"mM"===outputUnit?1e-6:void 0},parse:function(value){var valueToConvert=value;if(!angular.isNumber(valueToConvert)){var valueConverted=value.replace(/\s+/g,"").replace(",",".");return valueConverted=parseFloat(valueConverted)}return value}};return udtConvertValueServices};return constructor}]),angular.module("ultimateDataTableServices").factory("udtI18n",[function(){var constructor=function(preferedLanguageVar){var udtI18n={init:function(){if(this.preferedLanguage="en",!preferedLanguageVar)return!1;var preferedLanguage=[];Array.isArray(preferedLanguageVar)?preferedLanguage=preferedLanguageVar.slice():preferedLanguage.push(preferedLanguageVar),preferedLanguage.some(function(language){if(this.translationExist(language))return this.preferedLanguage=language,!0;var splitedLanguages=language.split("-");if(splitedLanguages.length>1){var primaryLanguageSubtag=splitedLanguages[0];if(this.translationExist(primaryLanguageSubtag))return this.preferedLanguage=primaryLanguageSubtag,!0}},this)},translationExist:function(language){return void 0!==this.translateTable[language]},translateTable:{fr:{result:"Rsultats","date.format":"dd/MM/yyyy","datetime.format":"dd/MM/yyyy HH:mm:ss","datatable.button.selectall":"Tout Slectionner","datatable.button.unselectall":"Tout Dlectionner","datatable.button.cancel":"Annuler","datatable.button.hide":"Cacher","datatable.button.show":"Afficher Dtails","datatable.button.edit":"Editer","datatable.button.sort":"Trier","datatable.button.save":"Sauvegarder","datatable.button.add":"Ajouter","datatable.button.remove":"Supprimer","datatable.button.searchLocal":"Rechercher","datatable.button.resetSearchLocal":"Annuler","datatable.button.length":"Taille ({0})","datatable.totalNumberRecords":"{0} Rsultat(s)","datatable.button.exportCSV":"Export CSV","datatable.msg.success.save":"Toutes les sauvegardes ont russi.","datatable.msg.error.save":"Il y a {0} sauvegarde(s) en erreur.","datatable.msg.success.remove":"Toutes les suppressions ont russi.","datatable.msg.error.remove":" Il y a {0} suppression(s) en erreur.","datatable.remove.confirm":"Pouvez-vous confirmer la suppression ?","datatable.export.sum":"(Somme)","datatable.export.average":"(Moyenne)","datatable.export.unique":"(Valeur uniq.)","datatable.export.countDistinct":"(Nb. distinct d'occurence)","datatable.export.yes":"Oui","datatable.export.no":"Non","datatable.button.group":"Grouper / Dgrouper","datatable.button.generalGroup":"Grouper toute la slection","datatable.button.basicExportCSV":"Exporter toutes les lignes","datatable.button.groupedExportCSV":"Exporter les lignes groupes","datatable.button.showOnlyGroups":"Voir uniquement les groupes"},en:{result:"Results","date.format":"MM/dd/yyyy","datetime.format":"MM/dd/yyyy HH:mm:ss","datatable.button.selectall":"Select all","datatable.button.unselectall":"Deselect all","datatable.button.cancel":"Cancel","datatable.button.hide":"Hide","datatable.button.show":"Show Details","datatable.button.edit":"Edit","datatable.button.sort":"Order","datatable.button.save":"Save","datatable.button.add":"Add","datatable.button.remove":"Remove","datatable.button.searchLocal":"Search","datatable.button.resetSearchLocal":"Cancel","datatable.button.length":"Size ({0})","datatable.totalNumberRecords":"{0} Result(s)","datatable.button.exportCSV":"CSV Export","datatable.msg.success.save":"All backups are successful.","datatable.msg.error.save":"There are {0} backup(s) in error.","datatable.msg.success.remove":"All the deletions are successful.","datatable.msg.error.remove":" There are {0} deletion(s) in error.","datatable.remove.confirm":"Can you confirm the delete ?","datatable.export.sum":"(Sum)","datatable.export.average":"(Average)","datatable.export.unique":"(Single value)","datatable.export.countDistinct":"(Num. of distinct occurrence)","datatable.export.yes":"Yes","datatable.export.no":"No","datatable.button.group":"Group / Ungroup","datatable.button.generalGroup":"Group All selected lines","datatable.button.basicExportCSV":"Export all lines","datatable.button.groupedExportCSV":"Export only grouped lines","datatable.button.showOnlyGroups":"See only group"},nl:{result:"Resultaten","date.format":"dd/MM/yyyy","datetime.format":"dd/MM/yyyy HH:mm:ss","datatable.button.selectall":"Selecteer alles","datatable.button.unselectall":"Deselecteer alles","datatable.button.cancel":"Annuleren","datatable.button.hide":"Verberg","datatable.button.show":"Toon details","datatable.button.edit":"Bewerk","datatable.button.sort":"Sorteer","datatable.button.save":"Opslaan","datatable.button.add":"Toevoegen","datatable.button.remove":"Verwijderen","datatable.button.searchLocal":"Zoek","datatable.button.resetSearchLocal":"Annuleer","datatable.button.length":"Grote ({0})","datatable.totalNumberRecords":"{0} Resultaten","datatable.button.exportCSV":"CSV Export","datatable.msg.success.save":"Opslag is succesvol","datatable.msg.error.save":"Er zijn {0} backup(s) met een fout.","datatable.msg.success.remove":"Alles is succesvol verwijderd.","datatable.msg.error.remove":" Er zijn {0} verwijderingen met een fout.","datatable.remove.confirm":"Bevestigd u de verwijdering?","datatable.export.sum":"(Som)","datatable.export.average":"(Gemiddeld)","datatable.export.unique":"(Enkele waarde)","datatable.export.countDistinct":"(Aantal unieke waarden)","datatable.export.yes":"Ja","datatable.export.no":"Nee","datatable.button.group":"Groeperen / Degroeperen","datatable.button.generalGroup":"Groepeer alle geselecteerde regels","datatable.button.basicExportCSV":"Exporteer alle regels","datatable.button.groupedExportCSV":"Exporteer alleen de gegroepeerde regels","datatable.button.showOnlyGroups":"Toon alleen de groep"}},Messages:function(key){var translatedString=this.translateTable[this.preferedLanguage][key];if(void 0===translatedString)return key;for(var i=1;i<arguments.length;i++)translatedString=translatedString.replace("{"+(i-1)+"}",arguments[i]);return translatedString}};return udtI18n.init(),udtI18n};return constructor}]);